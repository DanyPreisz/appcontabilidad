<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>App Contabilidad</title>
  <style>
    body { font-family: Arial; }
    .tab { display: none; }
    .active { display: block; }
    button { margin: 5px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ddd; padding: 8px; }
  </style>
</head>
<body>
  <h1>App Contabilidad</h1>
  <button onclick="showTab('compras')">Compras</button>
  <button onclick="showTab('ventas')">Ventas</button>
  <button onclick="showTab('pagos')">Pagos</button>
  <button onclick="showTab('cobros')">Cobros</button>

  <div id="compras" class="tab">
    <h2>Registrar Compra</h2>
    <form id="compraForm">
      <input type="text" placeholder="Proveedor" id="proveedor">
      <!-- Asume selección de productos similar a ventas -->
      <button type="button" onclick="registrarCompra()">Registrar</button>
    </form>
    <h2>Lista de Compras</h2>
    <table id="comprasTable"><tr><th>Fecha</th><th>Total</th><th>Proveedor</th></tr></table>
  </div>

  <div id="ventas" class="tab active">
    <!-- Contenido existente para ventas: form y tabla (agrega similar al de compras) -->
    <h2>Registrar Venta</h2>
    <form id="ventaForm">
      <input type="text" placeholder="Cliente" id="cliente">
      <!-- Productos, etc. -->
      <button type="button" onclick="registrarVenta()">Registrar</button>
    </form>
    <h2>Lista de Ventas</h2>
    <table id="ventasTable"><tr><th>Fecha</th><th>Total</th><th>Cliente</th></tr></table>
  </div>

  <div id="pagos" class="tab">
    <h2>Registrar Pago</h2>
    <form id="pagoForm">
      <input type="number" placeholder="Monto" id="montoPago">
      <input type="text" placeholder="Método" id="metodoPago">
      <input type="text" placeholder="Ref Compra ID" id="compraRef">
      <input type="text" placeholder="Proveedor" id="proveedorPago">
      <button type="button" onclick="registrarPago()">Registrar</button>
    </form>
    <h2>Lista de Pagos</h2>
    <table id="pagosTable"><tr><th>Fecha</th><th>Monto</th><th>Proveedor</th></tr></table>
  </div>

  <div id="cobros" class="tab">
    <h2>Registrar Cobro</h2>
    <form id="cobroForm">
      <input type="number" placeholder="Monto" id="montoCobro">
      <input type="text" placeholder="Método" id="metodoCobro">
      <input type="text" placeholder="Ref Venta ID" id="ventaRef">
      <input type="text" placeholder="Cliente" id="clienteCobro">
      <button type="button" onclick="registrarCobro()">Registrar</button>
    </form>
    <h2>Lista de Cobros</h2>
    <table id="cobrosTable"><tr><th>Fecha</th><th>Monto</th><th>Cliente</th></tr></table>
  </div>

  <script>
    function showTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
    }

    async function fetchAndDisplay(endpoint, tableId, columns) {
      const data = await fetch(`http://localhost:5000/api/${endpoint}`).then(res => res.json());
      const table = document.getElementById(tableId);
      table.innerHTML = ''; // Limpiar
      const header = table.insertRow();
      columns.forEach(col => {
        const th = document.createElement('th');
        th.textContent = col;
        header.appendChild(th);
      });
      data.forEach(item => {
        const row = table.insertRow();
        columns.forEach(col => row.insertCell().textContent = item[col.toLowerCase()] || 'N/A');
      });
    }

    // Funciones de registro (adaptar para productos complejos)
    async function registrarCompra() {
      // Lógica para enviar POST a /api/compras (agrega datos del form)
      alert('Compra registrada');
      fetchAndDisplay('compras', 'comprasTable', ['Fecha', 'Total', 'Proveedor']);
    }

    async function registrarVenta() {
      // Existente, adaptar
      alert('Venta registrada');
      fetchAndDisplay('ventas', 'ventasTable', ['Fecha', 'Total', 'Cliente']);
    }

    async function registrarPago() {
      const data = {
        monto: document.getElementById('montoPago').value,
        metodo: document.getElementById('metodoPago').value,
        compraRef: document.getElementById('compraRef').value,
        proveedor: document.getElementById('proveedorPago').value
      };
      await fetch('http://localhost:5000/api/pagos', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
      alert('Pago registrado');
      fetchAndDisplay('pagos', 'pagosTable', ['Fecha', 'Monto', 'Proveedor']);
    }

    async function registrarCobro() {
      const data = {
        monto: document.getElementById('montoCobro').value,
        metodo: document.getElementById('metodoCobro').value,
        ventaRef: document.getElementById('ventaRef').value,
        cliente: document.getElementById('clienteCobro').value
      };
      await fetch('http://localhost:5000/api/cobros', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(data) });
      alert('Cobro registrado');
      fetchAndDisplay('cobros', 'cobrosTable', ['Fecha', 'Monto', 'Cliente']);
    }

    // Cargar listas iniciales
    fetchAndDisplay('compras', 'comprasTable', ['Fecha', 'Total', 'Proveedor']);
    fetchAndDisplay('ventas', 'ventasTable', ['Fecha', 'Total', 'Cliente']);
    fetchAndDisplay('pagos', 'pagosTable', ['Fecha', 'Monto', 'Proveedor']);
    fetchAndDisplay('cobros', 'cobrosTable', ['Fecha', 'Monto', 'Cliente']);
  </script>
</body>
</html>
